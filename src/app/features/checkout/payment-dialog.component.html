<div class="payment-dialog">
  <div class="payment-header">
    <h2 mat-dialog-title>
      <mat-icon>credit_card</mat-icon>
      Procesar Pago
    </h2>
    <p class="payment-subtitle">
      Pedido #{{ orderNumber }} - Total: ${{ amount | number:'1.2-2' }}
    </p>
  </div>

  <mat-dialog-content class="payment-content">
    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
      <!-- Información de prueba -->
      <div class="test-info">
        <mat-icon>info</mat-icon>
        <div class="test-info-content">
          <h4>Información de Prueba</h4>
          <p><strong>Aprobado:</strong> 4111 1111 1111 1111</p>
          <p><strong>Rechazado:</strong> 4000 0000 0000 0002</p>
          <p><strong>CVC:</strong> Cualquier número de 3-4 dígitos</p>
        </div>
      </div>

      <!-- Número de tarjeta -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Número de tarjeta</mat-label>
        <input matInput
               formControlName="cardNumber"
               placeholder="4111 1111 1111 1111"
               (input)="onCardNumberInput($event)"
               maxlength="19">
        <mat-icon matSuffix>credit_card</mat-icon>
        <mat-error>{{ getCardNumberError() }}</mat-error>
      </mat-form-field>

      <!-- Nombre del titular -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre del titular</mat-label>
        <input matInput
               formControlName="holderName"
               placeholder="Juan Pérez"
               maxlength="50">
        <mat-icon matSuffix>person</mat-icon>
        <mat-error>{{ getHolderNameError() }}</mat-error>
      </mat-form-field>

      <!-- Fecha de vencimiento y CVC -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Mes</mat-label>
          <mat-select formControlName="expMonth">
            <mat-option *ngFor="let month of months" [value]="month.value">
              {{ month.label }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="paymentForm.get('expMonth')?.hasError('required')">
            El mes es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Año</mat-label>
          <mat-select formControlName="expYear">
            <mat-option *ngFor="let year of years" [value]="year">
              {{ year }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="paymentForm.get('expYear')?.hasError('required')">
            El año es requerido
          </mat-error>
        </mat-form-field>
      </div>

      <!-- CVC -->
      <mat-form-field appearance="outline" class="cvc-field">
        <mat-label>CVC</mat-label>
        <input matInput
               formControlName="cvc"
               placeholder="123"
               (input)="onCvcInput($event)"
               maxlength="4">
        <mat-icon matSuffix>lock</mat-icon>
        <mat-error>{{ getCvcError() }}</mat-error>
      </mat-form-field>

      <!-- Error message -->
      <div *ngIf="errorMessage()" class="error-message">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage() }}</span>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="payment-actions">
    <button mat-button
            type="button"
            (click)="onCancel()"
            [disabled]="isProcessing()">
      Cancelar
    </button>

    <button mat-raised-button
            color="primary"
            type="submit"
            (click)="onSubmit()"
            [disabled]="paymentForm.invalid || isProcessing()">
      <mat-spinner *ngIf="isProcessing()" diameter="20"></mat-spinner>
      <mat-icon *ngIf="!isProcessing()">payment</mat-icon>
      {{ isProcessing() ? 'Procesando...' : 'Pagar Ahora' }}
    </button>
  </mat-dialog-actions>
</div>

